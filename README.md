# Домашнее задание "Микросервисы: подходы"
# Решение для обеспечения непрерывной интеграции и поставки (CI/CD)

## Заголовок задачи

**Задача 1:** Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия

---

## 1. Предлагаемое решение

### Стек технологий

**Основные компоненты:**

| Компонент | Решение | Роль |
|-----------|---------|------|
| **Система контроля версий** | GitHub / GitLab | Хранение исходного кода и триггеры для сборок |
| **Платформа CI/CD** | GitLab CI / GitHub Actions | Оркестрация, управление пайплайнами и сборками |
| **Контейнеризация** | Docker | Создание и управление образами для сборки |
| **Оркестрация сборок** | Runners (GitLab CI) / Self-hosted Runners (GitHub Actions) | Выполнение задач сборки и тестирования |
| **Хранилище артефактов** | Docker Registry / Container Registry (встроенное) | Хранение собранных Docker-образов |
| **Управление секретами** | HashiCorp Vault / встроенное хранилище (GitHub Secrets) | Безопасное хранение учетных данных |

---

## 2. Архитектура решения

```
┌─────────────────────────────────────────────────────────────────┐
│                   РАЗРАБОТЧИК                                    │
│              (локальная рабочая среда)                          │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│              СИСТЕМА КОНТРОЛЯ ВЕРСИЙ (Git)                       │
│  ┌──────────────────┐  ┌──────────────────┐                    │
│  │ Репозиторий      │  │ Репозиторий      │  ...               │
│  │ сервис-1         │  │ сервис-2         │                    │
│  └────────┬─────────┘  └────────┬─────────┘                    │
└───────────┼──────────────────────┼──────────────────────────────┘
            │                      │
    (git push /              (git push /
     git pull request)        git pull request)
            │                      │
            ▼                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ПЛАТФОРМА CI/CD                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │         Webhook триггеры из Git                         │   │
│  │  • Push в main/develop                                  │   │
│  │  • Pull requests                                        │   │
│  │  • Manual trigger с параметрами                         │   │
│  └──────────────────┬──────────────────────────────────────┘   │
│                     │                                           │
│  ┌──────────────────▼──────────────────────────────────────┐   │
│  │     Управление пайплайнами (YAML конфиги)              │   │
│  │  • .gitlab-ci.yml или .github/workflows/                │   │
│  │  • Шаблоны для разных конфигураций                      │   │
│  │  • Параметризованные сборки                             │   │
│  └──────────────────┬──────────────────────────────────────┘   │
│                     │                                           │
│  ┌──────────────────▼──────────────────────────────────────┐   │
│  │      Хранилище переменных и секретов                    │   │
│  │  • Environment variables                                │   │
│  │  • Encrypted secrets                                    │   │
│  │  • Привязка к каждой сборке                             │   │
│  └──────────────────┬──────────────────────────────────────┘   │
└─────────────────────┼──────────────────────────────────────────┘
                      │
    ┌─────────────────┼─────────────────┐
    │                 │                 │
    ▼                 ▼                 ▼
┌───────────┐ ┌──────────────┐ ┌──────────────┐
│ Runner 1  │ │ Runner 2     │ │ Runner N ...  │
│(облачный) │ │(self-hosted) │ │(self-hosted)  │
└─────┬─────┘ └──────┬───────┘ └──────┬───────┘
      │              │               │
      │    ┌─────────┴───────┐       │
      │    │                 │       │
      ▼    ▼                 ▼       ▼
   ┌─────────────────────────────────────┐
   │  ВЫПОЛНЕНИЕ СБОРОК                  │
   │  • Build (Компиляция)               │
   │  • Test (Параллельное тестирование) │
   │  • Scan (SAST, SCA)                 │
   │  • Package (Создание артефактов)    │
   └──────────────────┬──────────────────┘
                      │
     ┌────────────────┼────────────────┐
     │                │                │
     ▼                ▼                ▼
┌──────────────┐ ┌──────────────┐ ┌─────────────┐
│   Docker     │ │   Maven/NPM  │ │   Другие    │
│   Registry   │ │   Registry   │ │ артефакты   │
└──────────────┘ └──────────────┘ └─────────────┘
                      │
     ┌────────────────┼────────────────┐
     │                │                │
     ▼                ▼                ▼
┌──────────────┐ ┌──────────────┐ ┌─────────────┐
│ DEV среда    │ │ TEST среда   │ │ PROD среда  │
│ (развертыв.) │ │ (развертыв.) │ │ (развертыв) │
└──────────────┘ └──────────────┘ └─────────────┘
```

---

## 3. Детальное описание компонентов

### 3.1 Система контроля версий

**Выбор: GitHub или GitLab**

#### GitHub
- **Преимущества:**
  - Встроенная платформа GitHub Actions
  - Лучший выбор для открытого кода и экосистемы
  - Простая интеграция с Actions Marketplace
  - Поддержка Pull Requests с автоматическими проверками
  
- **Недостатки:**
  - Платный для приватных проектов при большом использовании Actions
  - Менее гибкий для self-hosted runner'ов (по сравнению с GitLab)

#### GitLab (рекомендуется для корпоративных сценариев)
- **Преимущества:**
  - Встроенная платформа GitLab CI/CD
  - Отличная поддержка для self-hosted runners
  - Более полный контроль над инфраструктурой
  - Встроенное управление секретами
  - Бесплатный self-hosted вариант
  
- **Недостатки:**
  - Требует больше администрирования при self-hosted варианте
  - Меньше готовых интеграций по сравнению с GitHub


---

### 3.2 Управление секретными данными

**Решение: Встроенное хранилище + HashiCorp Vault (опционально)**

#### GitHub Secrets

**Иерархия секретов:**
- Глобальные переменные (на уровне организации)
- Переменные проекта (на уровне репозитория)
- Переменные окружения (для каждого развертывания)
- Переменные группы (для нескольких проектов)

**Лучшие практики:**
1. Никогда не коммитить секреты в Git
2. Использовать role-based access control (RBAC)
3. Регулярно ротировать ключи
4. Логировать доступ к секретам (audit logs)
5. Использовать Vault для очень чувствительных данных

---

## 4. Соответствие требованиям

| # | Требование | Решение | Статус |
|---|-----------|---------|--------|
| 1 | Облачная система | GitHub / GitLab cloud | ✓ |
| 2 | Система контроля версий Git | GitHub / GitLab | ✓ |
| 3 | Репозиторий на каждый сервис | Отдельные репо для каждого микросервиса | ✓ |
| 4 | Запуск сборки по событию Git | Webhooks, triggers (push, PR) | ✓ |
| 5 | Запуск сборки по кнопке с параметрами | `when: manual` в GitLab CI / `workflow_dispatch` в GitHub Actions | ✓ |
| 6 | Привязка настроек к сборке | Variables, environments, build parameters | ✓ |
| 7 | Шаблоны для различных конфигураций | `.extends`, `include`, reusable workflows | ✓ |
| 8 | Безопасное хранение секретных данных | GitHub Secrets / GitLab Variables (encrypted) | ✓ |
| 9 | Несколько конфигураций из одного репо | Matrix builds, parallel stages | ✓ |
| 10 | Кастомные шаги при сборке | Custom scripts, before_script, after_script | ✓ |
| 11 | Собственные Docker-образы | Custom Docker images в registry | ✓ |
| 12 | Развертывание агентов на своих серверах | GitLab Runner / GitHub self-hosted runner | ✓ |
| 13 | Параллельное запуск сборок | Parallel jobs, matrix strategy | ✓ |
| 14 | Параллельное запуск тестов | Test splitting, parallel: N | ✓ |

---

## 5. Обоснование выбора

### Почему GitLab CI/CD?

**Преимущества для корпоративного использования:**

1. **Полная интеграция с Git:**
   - CI/CD встроен в платформу GitLab
   - Нет необходимости интегрировать отдельные инструменты
   - Единая точка управления исходным кодом и сборками

2. **Гибкость Self-hosted Runner'ов:**
   - Полный контроль над инфраструктурой
   - Возможность развернуть runner'ы на собственных серверах
   - Выполнение сборок в закрытой сети компании

3. **Встроенное управление секретами:**
   - Зашифрованное хранилище переменных
   - Привязка переменных к окружениям
   - Логирование доступа (audit logs)

4. **Масштабируемость:**
   - Поддержка параллельных сборок из коробки
   - Встроенное кэширование артефактов
   - Эффективное распределение нагрузки между runner'ами

5. **Разработчик-ориентированность:**
   - YAML конфигурация легко читается и поддерживается
   - Обширная документация
   - Активное сообщество

### Альтернативы и почему не они

**GitHub Actions:**
- ✓ Хорош для open source
- ✗ Дорогой для приватных проектов при интенсивном использовании
- ✗ Менее гибкий для self-hosted инфраструктуры
- ✗ Привязан к GitHub (сложна миграция)

**Jenkins:**
- ✓ Высокая гибкость и расширяемость
- ✗ Требует значительного администрирования
- ✗ Устаревший интерфейс
- ✗ Проблемы с безопасностью при неправильной настройке

**CircleCI:**
- ✓ Облачное решение с быстрым стартом
- ✗ Лимитирован облачными ресурсами
- ✗ Сложнее развернуть свои runner'ы
- ✗ Дорогой при масштабировании

---

## 6. Заключение

**Предлагаемое решение** на основе **GitLab CI/CD** с self-hosted runner'ами обеспечивает:

✅ **Полный контроль** над процессом разработки и сборок  
✅ **Высокую масштабируемость** для растущих команд  
✅ **Безопасность** данных и учетных данных  
✅ **Гибкость** в конфигурациях и интеграциях  
✅ **Экономичность** при использовании самостоятельной инфраструктуры  

Это решение подходит как для стартапов, так и для крупных корпоративных организаций и соответствует всем указанным в задаче требованиям.
